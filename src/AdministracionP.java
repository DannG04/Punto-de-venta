
import javax.swing.table.DefaultTableModel;
/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */

/**
 *
 * @author 76905
 */
public class AdministracionP extends javax.swing.JPanel {
    
    ConexionBD conect = new ConexionBD();
    
    static DefaultTableModel modeloVentas = new DefaultTableModel();
    static DefaultTableModel modeloVenDet = new DefaultTableModel();
    DefaultTableModel modeloCaja = new DefaultTableModel();
    
    public AdministracionP() {
        initComponents();
        modeloVentas = (DefaultTableModel)tablaVentas.getModel();
        modeloVenDet = (DefaultTableModel)tablaVenDet.getModel();
        modeloCaja = (DefaultTableModel)tablaCierreCaja.getModel();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        ventaDetDialog = new javax.swing.JDialog();
        jScrollPane3 = new javax.swing.JScrollPane();
        tablaVenDet = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        labelVentaID = new javax.swing.JLabel();
        cierreCajaDialog = new javax.swing.JDialog();
        jScrollPane4 = new javax.swing.JScrollPane();
        tablaCierreCaja = new javax.swing.JTable();
        sumLabel = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jScrollPane5 = new javax.swing.JScrollPane();
        tablaVentas = new javax.swing.JTable();

        ventaDetDialog.setTitle("Registro de Ventas");
        ventaDetDialog.setAlwaysOnTop(true);
        ventaDetDialog.setMinimumSize(new java.awt.Dimension(650, 450));
        ventaDetDialog.setModal(true);
        ventaDetDialog.setResizable(false);
        ventaDetDialog.setSize(new java.awt.Dimension(650, 450));

        tablaVenDet.setFont(new java.awt.Font("Noto Serif", 0, 14)); // NOI18N
        tablaVenDet.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Producto", "Cantidad", "Precio Dado", "Precio Total", "Tipo Venta"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane3.setViewportView(tablaVenDet);

        ventaDetDialog.getContentPane().add(jScrollPane3, java.awt.BorderLayout.CENTER);

        jPanel2.setLayout(new java.awt.BorderLayout());

        labelVentaID.setFont(new java.awt.Font("Noto Serif", 1, 36)); // NOI18N
        labelVentaID.setForeground(new java.awt.Color(78, 150, 150));
        labelVentaID.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        labelVentaID.setText("Venta: ");
        jPanel2.add(labelVentaID, java.awt.BorderLayout.CENTER);

        ventaDetDialog.getContentPane().add(jPanel2, java.awt.BorderLayout.NORTH);

        ventaDetDialog.setLocationRelativeTo(null);

        cierreCajaDialog.setTitle("CIERRE DE CAJA");
        cierreCajaDialog.setMinimumSize(new java.awt.Dimension(550, 450));
        cierreCajaDialog.setLocationRelativeTo(null);
        cierreCajaDialog.setResizable(false);
        cierreCajaDialog.setSize(new java.awt.Dimension(550, 450));

        tablaCierreCaja.setFont(new java.awt.Font("Liberation Serif", 0, 18)); // NOI18N
        tablaCierreCaja.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Venta", "Total", "Fecha"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane4.setViewportView(tablaCierreCaja);

        cierreCajaDialog.getContentPane().add(jScrollPane4, java.awt.BorderLayout.CENTER);

        sumLabel.setBackground(new java.awt.Color(255, 255, 255));
        sumLabel.setFont(new java.awt.Font("Noto Serif", 1, 24)); // NOI18N
        sumLabel.setForeground(new java.awt.Color(78, 150, 150));
        sumLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        sumLabel.setText("Suma: ");
        sumLabel.setPreferredSize(new java.awt.Dimension(81, 40));
        cierreCajaDialog.getContentPane().add(sumLabel, java.awt.BorderLayout.PAGE_END);

        cierreCajaDialog.setAlwaysOnTop(true);

        setLayout(new java.awt.BorderLayout());

        jPanel1.setLayout(new java.awt.BorderLayout());

        jLabel2.setFont(new java.awt.Font("Noto Serif", 1, 36)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(78, 150, 150));
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setText("Ventas");
        jPanel1.add(jLabel2, java.awt.BorderLayout.CENTER);

        add(jPanel1, java.awt.BorderLayout.NORTH);

        tablaVentas.setFont(new java.awt.Font("Noto Serif", 0, 18)); // NOI18N
        tablaVentas.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Venta", "Empleado", "Cliente", "Monto", "Fecha"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tablaVentas.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tablaVentasMouseClicked(evt);
            }
        });
        jScrollPane5.setViewportView(tablaVentas);

        add(jScrollPane5, java.awt.BorderLayout.CENTER);
    }// </editor-fold>//GEN-END:initComponents

    private void tablaVentasMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tablaVentasMouseClicked
        //Verifica si se ha seleccionado una fila
        if(tablaVentas.getSelectedRow() != -1){
            labelVentaID.setText("Venta: " + modeloVentas.getValueAt(tablaVentas.getSelectedRow(), 0));
            mostrarTablaVentasDet("" + modeloVentas.getValueAt(tablaVentas.getSelectedRow(), 0));
            ventaDetDialog.setVisible(true);
        }
    }//GEN-LAST:event_tablaVentasMouseClicked

    public void mostrarTablaVentas(){
        //Limpia la tabla
        Mise.limpiarTabla(modeloVentas);
        java.sql.ResultSet rs = conect.query("SELECT * FROM venta");
        try{
            while(rs.next()){
                modeloVentas.addRow(new Object[]{rs.getString("id_venta"), rs.getString("id_empleado"), rs.getString("id_cliente"), rs.getDouble("total_venta"), rs.getDate("fecha_venta")});
            }
        } catch(java.sql.SQLException e){
            System.out.println("Error al mostrar la tabla de ventas");
        }
    }
    
    public void mostrarTablaVentasDet(String id_venta){//Muestra la tabla de ventas detalle
        Mise.limpiarTabla(modeloVenDet);
        java.sql.ResultSet rs = conect.query("SELECT * FROM venta_detalle WHERE id_venta='" + id_venta + "';");
        try{
            while(rs.next()){
                modeloVenDet.addRow(new Object[]{rs.getString("id_producto"), rs.getInt("cantidad_producto"), rs.getDouble("precio_dado"), rs.getDouble("precio_total"), rs.getString("tipo_venta")});
            }
        } catch(java.sql.SQLException e){
            System.out.println("Error al mostrar la tabla de venta detalle");
        }
    }
    
    public void mostrarCierreCaja(){//Muestra el cierre de caja
        Mise.limpiarTabla(modeloCaja);
        String fecha = generarFecha("yyyy-MM-dd");
        java.sql.ResultSet rs = conect.query("SELECT * FROM venta WHERE fecha_venta='" + fecha + "';");
        try{
            while(rs.next()){
                modeloCaja.addRow(new Object[]{rs.getString("id_venta"), rs.getDouble("total_venta"), rs.getDate("fecha_venta")});
            }
            java.sql.ResultSet rsSum =conect.query("SELECT SUM(total_venta) FROM venta WHERE fecha_venta='" + fecha + "';");
            try{
                while(rsSum.next()){
                    sumLabel.setText("Total: " + rsSum.getDouble(1));
                }
            }catch(Exception e){
                System.out.println("Error al sumar los totales");
            }
        } catch(java.sql.SQLException e){
            System.out.println("Error al mostrar el cierre de caja");
        }
    }
    
    public String generarFecha(String formato){//Genera la fecha
        java.time.LocalDateTime ahora = java.time.LocalDateTime.now();
        java.time.format.DateTimeFormatter formateado = java.time.format.DateTimeFormatter.ofPattern(formato);
        return ahora.format(formateado);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public javax.swing.JDialog cierreCajaDialog;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JLabel labelVentaID;
    private javax.swing.JLabel sumLabel;
    private javax.swing.JTable tablaCierreCaja;
    private javax.swing.JTable tablaVenDet;
    private javax.swing.JTable tablaVentas;
    public static javax.swing.JDialog ventaDetDialog;
    // End of variables declaration//GEN-END:variables
}
